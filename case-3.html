<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 5 Case 3 | Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective</title>
  <meta name="description" content="Section 5 Case 3 | Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 5 Case 3 | Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://23verse.github.io/gini" />
  
  <meta property="og:description" content="Section 5 Case 3 | Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective." />
  <meta name="github-repo" content="23verse/gini" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 5 Case 3 | Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective" />
  
  <meta name="twitter:description" content="Section 5 Case 3 | Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="case-2.html"/>
<link rel="next" href="session-info.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">GINI</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="materials.html"><a href="materials.html"><i class="fa fa-check"></i><b>2</b> Materials</a></li>
<li class="chapter" data-level="3" data-path="case-1.html"><a href="case-1.html"><i class="fa fa-check"></i><b>3</b> Case 1</a></li>
<li class="chapter" data-level="4" data-path="case-2.html"><a href="case-2.html"><i class="fa fa-check"></i><b>4</b> Case 2</a></li>
<li class="chapter" data-level="5" data-path="case-3.html"><a href="case-3.html"><i class="fa fa-check"></i><b>5</b> Case 3</a></li>
<li class="chapter" data-level="6" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>6</b> Session Info</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Genetic Interaction Network Interpretation (GINI): A Tidy Data Science Perspective</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="case-3" class="section level1">
<h1><span class="header-section-number">Section 5</span> Case 3</h1>
<p>In this case, we introduce a more advanced analysis workflow (FIGURE <a href="case-3.html#fig:3-schematic">5.1</a>), showing how to identify tissue clusters (<code>Steps 2 and 7</code>) and differential interactions (<code>Steps 8-10</code>) based on the integration of genetic interactions with gene expression.</p>
<div class="figure" style="text-align: center"><span id="fig:3-schematic"></span>
<img src="GINI_files/figure-html/3-schematic-1.png" alt="Schematic illustration of tissue clustering and differential analysis in lights of genetic interactions. Key steps labelled that are detailed below." width="100%" />
<p class="caption">
FIGURE 5.1: Schematic illustration of tissue clustering and differential analysis in lights of genetic interactions. Key steps labelled that are detailed below.
</p>
</div>
<blockquote>
<p><strong>Step 1: Load the packages and import human genetic interaction data as well as human tissue gene expression data (see <a href="materials.html#materials">Materials</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># load the packages used in this case</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw">library</span>(XGR)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="kw">library</span>(limma)</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="kw">library</span>(biobroom)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb23-11" data-line-number="11"></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="co"># also load the package &quot;osfr&quot; aided in importing data from https://osf.io/gskpn</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="kw">library</span>(osfr)</a>
<a class="sourceLine" id="cb23-14" data-line-number="14">guid &lt;-<span class="st"> &quot;gskpn&quot;</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"></a>
<a class="sourceLine" id="cb23-16" data-line-number="16"><span class="co"># import genetic interaction data</span></a>
<a class="sourceLine" id="cb23-17" data-line-number="17"><span class="co"># converted into two tibbles &quot;vertices&quot; and &quot;edges&quot;</span></a>
<a class="sourceLine" id="cb23-18" data-line-number="18">ig.BioGRID_genetic &lt;-<span class="st"> </span><span class="kw">xRDataLoader</span>(<span class="st">&quot;ig.BioGRID_genetic&quot;</span>, <span class="dt">guid=</span>guid)</a>
<a class="sourceLine" id="cb23-19" data-line-number="19">ig.BioGRID_genetic <span class="op">%&gt;%</span><span class="st"> </span>igraph<span class="op">::</span><span class="kw">as_data_frame</span>(<span class="st">&quot;vertices&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() -&gt;<span class="st"> </span>vertices</a>
<a class="sourceLine" id="cb23-20" data-line-number="20">ig.BioGRID_genetic <span class="op">%&gt;%</span><span class="st"> </span>igraph<span class="op">::</span><span class="kw">as_data_frame</span>(<span class="st">&quot;edges&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() -&gt;<span class="st"> </span>edges</a>
<a class="sourceLine" id="cb23-21" data-line-number="21"></a>
<a class="sourceLine" id="cb23-22" data-line-number="22"><span class="co"># import gene expression data</span></a>
<a class="sourceLine" id="cb23-23" data-line-number="23">GTEx_V8_TPM_boxplot &lt;-<span class="st"> </span><span class="kw">xRDataLoader</span>(<span class="st">&quot;GTEx_V8_TPM_boxplot&quot;</span>, <span class="dt">guid=</span>guid)</a></code></pre></div>
<blockquote>
<p><strong>Step 2. Estimate tissue-specific interaction weights.</strong></p>
</blockquote>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># nested by tissues</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co"># calculate weight for each interaction and for each tissue</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co"># return a tibble &quot;df_nested&quot; with a list-column &quot;interactions&quot;</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">GTEx_V8_TPM_boxplot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nest</span>(<span class="dt">data=</span><span class="op">-</span>SMTSD) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="kw">mutate</span>(<span class="dt">interactions=</span><span class="kw">map</span>(data, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">    x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Symbol,middle) -&gt;<span class="st"> </span>x</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">    edges <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(x, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;from&quot;</span>=<span class="st">&quot;Symbol&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">from_TPM=</span>middle) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="st">    </span><span class="kw">inner_join</span>(x, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;to&quot;</span>=<span class="st">&quot;Symbol&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">to_TPM=</span>middle) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">weight=</span><span class="kw">sqrt</span>(<span class="kw">log10</span>(from_TPM<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="kw">log10</span>(<span class="dv">1</span><span class="op">+</span>to_TPM)))</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">})) -&gt;<span class="st"> </span>df_nested</a></code></pre></div>
<blockquote>
<p><strong>Step 3. Extract tissue-specific interactions.</strong></p>
</blockquote>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># unnested by interactions</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co"># add interaction name &quot;name&quot;</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co"># return a tibble &quot;df_interactions&quot;</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">df_nested <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SMTSD, interactions) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(interactions) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="kw">mutate</span>(<span class="dt">name=</span><span class="kw">str_c</span>(from,<span class="st">&quot;&lt;-&gt;&quot;</span>,to)) -&gt;<span class="st"> </span>df_interactions</a></code></pre></div>
<blockquote>
<p><strong>Step 4. Prepare a tissue-interaction matrix.</strong></p>
</blockquote>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># pivot data from long to wide</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co"># return a data frame &quot;mat&quot; </span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co"># also used for differential interaction analysis at Step 8</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">mat &lt;-<span class="st"> </span>df_interactions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SMTSD, name, weight) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="kw">pivot_wider</span>(<span class="dt">names_from=</span>SMTSD, <span class="dt">values_from=</span>weight) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_to_rownames</span>(<span class="st">&quot;name&quot;</span>) </a></code></pre></div>
<blockquote>
<p><strong>Step 5. Conduct the <code>multidimensional scaling</code> on tissues.</strong></p>
</blockquote>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># based on the pairwise distance between tissues, projected onto 2D space </span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">t</span>(mat) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cmdscale</span>(<span class="dv">2</span>, <span class="dt">eig=</span>T) -&gt;<span class="st"> </span>res</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co"># extract tissue coordinates on 2D space</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co"># return a tibble &quot;coord_tissues&quot; with 3 columns </span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co"># &quot;SMTSD&quot; for tissues, &quot;x1&quot; and &quot;x2&quot; for 2D coordinates</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7">res<span class="op">$</span>points <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_colnames</span>(<span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>(<span class="dt">rownames=</span><span class="st">&quot;SMTSD&quot;</span>) -&gt;<span class="st"> </span>coord_tissues</a></code></pre></div>
<blockquote>
<p><strong>Step 6. Optimise the number of tissue clusters using <code>K-means</code> (FIGURE <a href="case-3.html#fig:3-elbow">5.2</a> and FIGURE <a href="case-3.html#fig:3-cluster">5.3</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># perform K-means clustering using a series of cluster numbers (k)</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="co"># summarise clustering output</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="co"># set seed to reproduce results</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="co"># return a tibble &quot;kclusts&quot;</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="kw">set.seed</span>(<span class="dv">825</span>)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">coord_tissues <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(x1,x2) -&gt;<span class="st"> </span>data</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">kclusts &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">k=</span><span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">res=</span><span class="kw">map</span>(k, <span class="op">~</span><span class="kw">kmeans</span>(data,.x)),</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">    <span class="dt">glanced=</span><span class="kw">map</span>(res, glance), <span class="dt">augmented=</span><span class="kw">map</span>(res, <span class="op">~</span><span class="kw">augment</span>(.x,data))</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb28-10" data-line-number="10"></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="co"># the variance within the clusters decreases as k increases</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="co"># the bend/elbow point indicates no gain having more clusters</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13">kclusts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(glanced) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(k, tot.withinss)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</a>
<a class="sourceLine" id="cb28-14" data-line-number="14"></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="co"># tissues colored by clusters for each value of k</span></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co"># note: the same color only means tissues within the same cluster</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17">kclusts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(augmented) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">k=</span><span class="kw">str_c</span>(<span class="st">&quot;k=&quot;</span>,k)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x1,x2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>.cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>k,<span class="dt">ncol=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:3-elbow"></span>
<img src="GINI_files/figure-html/3-elbow-1.png" alt="Line plot showing the total variance within clusters against the predefined cluster numbers (k). The elbow is seen at k=5, that is, the optimal cluster number minimising within-cluster variance." width="30%" />
<p class="caption">
FIGURE 5.2: Line plot showing the total variance within clusters against the predefined cluster numbers (k). The elbow is seen at k=5, that is, the optimal cluster number minimising within-cluster variance.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:3-cluster"></span>
<img src="GINI_files/figure-html/3-cluster-1.png" alt="Dot plot of tissues color-coded by clusters. For example, at k=5, tissues are separated into five clusters and colored differently. Each tissue has 2D coordinates (x1 and x2) resulted from multidimensional scaling of interactions versus tissues matrix." width="80%" />
<p class="caption">
FIGURE 5.3: Dot plot of tissues color-coded by clusters. For example, at k=5, tissues are separated into five clusters and colored differently. Each tissue has 2D coordinates (x1 and x2) resulted from multidimensional scaling of interactions versus tissues matrix.
</p>
</div>
<blockquote>
<p><strong>Step 7. Visualise the optimal tissue clusters (FIGURE <a href="case-3.html#fig:3-k5">5.4</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># assign tissues to one of 5 clusters (optimal)</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co"># return a tibble &quot;assignments&quot;</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">kclusts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(augmented) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(k<span class="op">==</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="kw">left_join</span>(coord_tissues, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>)) -&gt;<span class="st"> </span>assignments</a>
<a class="sourceLine" id="cb29-5" data-line-number="5"></a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="co"># tissues shaped by clusters</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="co"># label brain-derived tissues: two clusters revealed</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="co"># cluster 4 (cerebellar tissues)</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="co"># cluster 5 (the rest brain tissues)</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10">assignments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(SMTSD, <span class="st">&quot;Brain&quot;</span>)) -&gt;<span class="st"> </span>data</a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="kw">ggplot</span>(assignments, <span class="kw">aes</span>(x1,x2,<span class="dt">shape=</span>.cluster)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-12" data-line-number="12"><span class="kw">geom_text_repel</span>(<span class="dt">data=</span>data, <span class="kw">aes</span>(<span class="dt">label=</span>SMTSD), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_light</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:3-k5"></span>
<img src="GINI_files/figure-html/3-k5-1.png" alt="Dot plot of tissues at k=5, shaped by clusters. Brain-derived tissues are labelled to show that all brain tissues are clustered together (cluster 5) except two cerebellar tissues (cluster 4)." width="80%" />
<p class="caption">
FIGURE 5.4: Dot plot of tissues at k=5, shaped by clusters. Brain-derived tissues are labelled to show that all brain tissues are clustered together (cluster 5) except two cerebellar tissues (cluster 4).
</p>
</div>
<blockquote>
<p><strong>Step 8. Detect differential interactions between cluster 5 and other clusters.</strong></p>
</blockquote>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># define the design matrix</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="co"># return a matrix &quot;design&quot;</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3">assignments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">group=</span><span class="kw">ifelse</span>(.cluster<span class="op">==</span><span class="dv">5</span>, <span class="st">&quot;test&quot;</span>, <span class="st">&quot;other&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="kw">select</span>(SMTSD,group) -&gt;<span class="st"> </span>df_group</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">df_group <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(group) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">levels</span>() -&gt;<span class="st"> </span>lvls</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="kw">model.matrix</span>(<span class="op">~</span><span class="dv">0</span><span class="op">+</span><span class="kw">factor</span>(group),df_group) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_colnames</span>(lvls) -&gt;<span class="st"> </span>design</a>
<a class="sourceLine" id="cb30-7" data-line-number="7"></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="co"># fit linear model</span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9">fit &lt;-<span class="st"> </span><span class="kw">lmFit</span>(mat, design)</a>
<a class="sourceLine" id="cb30-10" data-line-number="10"></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="co"># construct contrast (cluster 5 tested against other clusters)</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12">contrast.matrix &lt;-<span class="st"> </span><span class="kw">makeContrasts</span>(<span class="dt">contrasts=</span><span class="st">&quot;test-other&quot;</span>, <span class="dt">levels=</span>design)</a>
<a class="sourceLine" id="cb30-13" data-line-number="13"></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co"># computer contrast from fitted linear model</span></a>
<a class="sourceLine" id="cb30-15" data-line-number="15">fit2 &lt;-<span class="st"> </span><span class="kw">contrasts.fit</span>(fit, contrast.matrix)</a>
<a class="sourceLine" id="cb30-16" data-line-number="16"></a>
<a class="sourceLine" id="cb30-17" data-line-number="17"><span class="co"># calculate empirical Bayes statistics for differential interactions</span></a>
<a class="sourceLine" id="cb30-18" data-line-number="18">eb &lt;-<span class="st"> </span><span class="kw">eBayes</span>(fit2)</a>
<a class="sourceLine" id="cb30-19" data-line-number="19"></a>
<a class="sourceLine" id="cb30-20" data-line-number="20"><span class="co"># tidy eBayes results, and calculate adjusted p-values</span></a>
<a class="sourceLine" id="cb30-21" data-line-number="21"><span class="co"># return a tibble &quot;df_results&quot;</span></a>
<a class="sourceLine" id="cb30-22" data-line-number="22"><span class="kw">tidy</span>(eb) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nest</span>(<span class="dt">data=</span><span class="op">-</span>term) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">adjp=</span><span class="kw">map</span>(data,<span class="op">~</span><span class="kw">p.adjust</span>(.x<span class="op">$</span>p.value,<span class="dt">method=</span><span class="st">&quot;BH&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(<span class="kw">c</span>(data,adjp)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(adjp) -&gt;<span class="st"> </span>df_results</a></code></pre></div>
<blockquote>
<p><strong>Step 9. Draw volcano plot showing differential interactions (FIGURE <a href="case-3.html#fig:3-volcano">5.5</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># coefficient estimate [log2(fold change)] vs adjusted p-values</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co"># colored by empirical Bayes t-statistic, using the color scheme &quot;jet.both&quot;</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co"># return a ggplot object &quot;gg&quot;</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">df_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>estimate, <span class="dt">y=</span><span class="op">-</span><span class="kw">log10</span>(adjp), <span class="dt">color=</span>statistic)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors=</span><span class="kw">xColormap</span>(<span class="st">&quot;jet.both&quot;</span>)(<span class="dv">64</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="st">&quot;none&quot;</span>) -&gt;<span class="st"> </span>gg</a>
<a class="sourceLine" id="cb31-6" data-line-number="6"></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="co"># label the top 10 interactions abundant in cluster 5</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8">df_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(estimate<span class="op">&gt;</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">10</span>, <span class="op">-</span>adjp) -&gt;<span class="st"> </span>data</a>
<a class="sourceLine" id="cb31-9" data-line-number="9">gg <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_repel</span>(<span class="dt">data=</span>data, <span class="kw">aes</span>(<span class="dt">label=</span>gene), <span class="dt">color=</span><span class="st">&quot;black&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>) </a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:3-volcano"></span>
<img src="GINI_files/figure-html/3-volcano-1.png" alt="Volcano plot showing differential interactions. Colored by empirical Bayes t-statistic, labelled for the top 10 interactions abundant in cluster 5." width="80%" />
<p class="caption">
FIGURE 5.5: Volcano plot showing differential interactions. Colored by empirical Bayes t-statistic, labelled for the top 10 interactions abundant in cluster 5.
</p>
</div>
<blockquote>
<p><strong>Step 10. Construct and visualise a network of abundant interactions in cluster 5 (FIGURE <a href="case-3.html#fig:3-network">5.6</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="co"># extract edges with adjp &lt; 0.01</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">df_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(estimate<span class="op">&gt;</span><span class="dv">0</span>, adjp<span class="op">&lt;</span><span class="fl">0.01</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">separate</span>(gene,<span class="kw">c</span>(<span class="st">&quot;from&quot;</span>,<span class="st">&quot;to&quot;</span>),<span class="dt">sep=</span><span class="st">&quot;&lt;-&gt;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="kw">select</span>(from,to,estimate) <span class="op">%&gt;%</span><span class="st"> </span>as.data.frame -&gt;<span class="st"> </span>edges_ab</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co"># extract nodes with adjp &lt; 0.01</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7">df_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(estimate<span class="op">&gt;</span><span class="dv">0</span>, adjp<span class="op">&lt;</span><span class="fl">0.01</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="kw">separate_rows</span>(gene, <span class="dt">sep=</span><span class="st">&quot;&lt;-&gt;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(gene) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">name=</span>gene) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="kw">inner_join</span>(vertices, <span class="dt">by=</span><span class="st">&quot;name&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() -&gt;<span class="st"> </span>nodes_ab</a>
<a class="sourceLine" id="cb32-10" data-line-number="10"></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="co"># construct the network </span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="co"># return an igraph object &quot;ig_ab&quot;</span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13">ig_ab &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw">graph_from_data_frame</span>(<span class="dt">d=</span>edges_ab, <span class="dt">directed=</span>F, <span class="dt">vertices=</span>nodes_ab) </a>
<a class="sourceLine" id="cb32-14" data-line-number="14"></a>
<a class="sourceLine" id="cb32-15" data-line-number="15"><span class="co"># the object &quot;ig_ab&quot; appended with two node attributes &quot;xcoord&quot; and &quot;ycoord&quot;</span></a>
<a class="sourceLine" id="cb32-16" data-line-number="16"><span class="co"># coordinates calculated using the Fruchterman-Reingold layout algorithm</span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">ig_ab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xLayout</span>(<span class="st">&quot;gplot.layout.fruchtermanreingold&quot;</span>) -&gt;<span class="st"> </span>ig_ab</a>
<a class="sourceLine" id="cb32-18" data-line-number="18"></a>
<a class="sourceLine" id="cb32-19" data-line-number="19"><span class="co"># the object &quot;ig_ab&quot; appended with a node attribute &quot;degree&quot; (the node degree)</span></a>
<a class="sourceLine" id="cb32-20" data-line-number="20">igraph<span class="op">::</span><span class="kw">degree</span>(ig_ab) -&gt;<span class="st"> </span><span class="kw">V</span>(ig_ab)<span class="op">$</span>degree</a>
<a class="sourceLine" id="cb32-21" data-line-number="21"></a>
<a class="sourceLine" id="cb32-22" data-line-number="22"><span class="co"># the object &quot;ig_ab&quot; appended with a node attribute &quot;label&quot;</span></a>
<a class="sourceLine" id="cb32-23" data-line-number="23"><span class="co"># in order to label nodes with 2 or more neighbors</span></a>
<a class="sourceLine" id="cb32-24" data-line-number="24"><span class="kw">ifelse</span>(<span class="kw">V</span>(ig_ab)<span class="op">$</span>degree<span class="op">&gt;=</span><span class="dv">2</span>, <span class="kw">V</span>(ig_ab)<span class="op">$</span>name, <span class="st">&quot;&quot;</span>) -&gt;<span class="st"> </span><span class="kw">V</span>(ig_ab)<span class="op">$</span>label</a>
<a class="sourceLine" id="cb32-25" data-line-number="25"></a>
<a class="sourceLine" id="cb32-26" data-line-number="26"><span class="co"># visualise the network</span></a>
<a class="sourceLine" id="cb32-27" data-line-number="27"><span class="co"># label nodes with 2 or more neighbors</span></a>
<a class="sourceLine" id="cb32-28" data-line-number="28"><span class="co"># nodes placed by coordinates on the plane</span></a>
<a class="sourceLine" id="cb32-29" data-line-number="29"><span class="co"># nodes sized by degree</span></a>
<a class="sourceLine" id="cb32-30" data-line-number="30"><span class="co"># return a ggplot object &quot;gg_ab&quot;</span></a>
<a class="sourceLine" id="cb32-31" data-line-number="31">ig_ab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xGGnetwork</span>(<span class="dt">node.label=</span><span class="st">&quot;label&quot;</span>, <span class="dt">node.label.size=</span><span class="fl">1.5</span>, <span class="dt">node.xcoord=</span><span class="st">&quot;xcoord&quot;</span>, <span class="dt">node.ycoord=</span><span class="st">&quot;ycoord&quot;</span>, <span class="dt">node.size=</span><span class="st">&quot;degree&quot;</span>, <span class="dt">node.size.range=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">4</span>), <span class="dt">edge.color=</span><span class="st">&quot;lightblue&quot;</span>, <span class="dt">edge.arrow.gap=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">size=</span><span class="st">&quot;none&quot;</span>) -&gt;<span class="st"> </span>gg_up</a>
<a class="sourceLine" id="cb32-32" data-line-number="32">gg_up</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:3-network"></span>
<img src="GINI_files/figure-html/3-network-1.png" alt="Network visualisation of interactions abundant in cluster 5. Nodes sized by degree (i.e. the number of neighbors), and if having two or more neighbors, also labelled." width="80%" />
<p class="caption">
FIGURE 5.6: Network visualisation of interactions abundant in cluster 5. Nodes sized by degree (i.e. the number of neighbors), and if having two or more neighbors, also labelled.
</p>
</div>
<blockquote>
<p><strong>Step 11. Perform KEGG pathway enrichment analysis for genes involved in abundant interactions in cluster 5 (FIGURE <a href="case-3.html#fig:3-kegg">5.7</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># define the test background (all interacting genes)</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">df_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate_rows</span>(gene, <span class="dt">sep=</span><span class="st">&quot;&lt;-&gt;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="kw">distinct</span>(gene) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(gene) -&gt;<span class="st"> </span>background</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co"># perform enrichment analysis using KEGG pathways</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co"># return an eTerm object &quot;eTerm_kegg&quot;</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="kw">V</span>(ig_ab)<span class="op">$</span>name <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xEnricherGenes</span>(<span class="dt">background=</span>background, <span class="dt">ontology=</span><span class="st">&quot;KEGG&quot;</span>, <span class="dt">guid=</span>guid) -&gt;<span class="st"> </span>eTerm_kegg</a>
<a class="sourceLine" id="cb33-8" data-line-number="8"></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co"># visualise enriched pathways faceted by category</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co"># label up to top 3 per category</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11">eTerm_kegg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xEnrichViewer</span>(<span class="st">&quot;all&quot;</span>, <span class="dt">detail=</span>T) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">group=</span>namespace) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(group <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Cellular Process&quot;</span>,<span class="st">&quot;Environmental Process&quot;</span>,<span class="st">&quot;Human Diseases&quot;</span>,<span class="st">&quot;Organismal Systems&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xEnrichDotplot</span>(<span class="dt">label.top=</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>group, <span class="dt">ncol=</span><span class="dv">4</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:3-kegg"></span>
<img src="GINI_files/figure-html/3-kegg-1.png" alt="Pathway analysis of genes involved in interactions abundant in cluster 5. Based on KEGG pathways grouped into four categories. The dot plot is shown separately for each category, with the top 3 enriched pathways labelled for each category using one-sided Fisher's exact test." width="100%" />
<p class="caption">
FIGURE 5.7: Pathway analysis of genes involved in interactions abundant in cluster 5. Based on KEGG pathways grouped into four categories. The dot plot is shown separately for each category, with the top 3 enriched pathways labelled for each category using one-sided Fisher’s exact test.
</p>
</div>
<blockquote>
<p><strong>Step 12. Conduct evolutionary analysis for genes involved in abundant interactions in cluster 5 (FIGURE <a href="case-3.html#fig:3-evolution">5.8</a>).</strong></p>
</blockquote>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="co"># define the test background (all interacting genes)</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">df_results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate_rows</span>(gene,<span class="dt">sep=</span><span class="st">&quot;&lt;-&gt;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="kw">distinct</span>(gene) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(gene) -&gt;<span class="st"> </span>background</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="co"># perform evolutionary analysis using phylostratigraphy</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="co"># based on two-sided Fisher&#39;s exact test</span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="co"># return an eTerm object &quot;eTerm_psg&quot;</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8"><span class="kw">V</span>(ig_ab)<span class="op">$</span>name <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xEnricherGenes</span>(<span class="dt">background=</span>background, <span class="dt">ontology=</span><span class="st">&quot;PSG&quot;</span>, <span class="dt">size.range=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20000</span>), <span class="dt">p.tail=</span><span class="st">&quot;two-tails&quot;</span>, <span class="dt">guid=</span>guid) -&gt;<span class="st"> </span>eTerm_psg</a>
<a class="sourceLine" id="cb34-9" data-line-number="9"></a>
<a class="sourceLine" id="cb34-10" data-line-number="10"><span class="co"># forest plot for all ancestors analysed</span></a>
<a class="sourceLine" id="cb34-11" data-line-number="11"><span class="co"># return an ggplot object &quot;gg_psg&quot;</span></a>
<a class="sourceLine" id="cb34-12" data-line-number="12"><span class="kw">xEnrichForest</span>(eTerm_psg, <span class="dt">top_num=</span><span class="st">&quot;auto&quot;</span>, <span class="dt">FDR.cutoff=</span><span class="dv">1</span>, <span class="dt">sortBy=</span><span class="st">&quot;none&quot;</span>) -&gt;<span class="st"> </span>gg_psg</a>
<a class="sourceLine" id="cb34-13" data-line-number="13"></a>
<a class="sourceLine" id="cb34-14" data-line-number="14"><span class="co"># a table listing genes first created at the ancestors (enriched only) </span></a>
<a class="sourceLine" id="cb34-15" data-line-number="15"><span class="co"># return a gtable object &quot;gt_psg&quot;</span></a>
<a class="sourceLine" id="cb34-16" data-line-number="16">eTerm_psg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xEnrichViewer</span>(<span class="st">&quot;all&quot;</span>, <span class="dt">details=</span>T) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>(<span class="dt">rownames=</span><span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-17" data-line-number="17"><span class="kw">mutate</span>(<span class="dt">id=</span><span class="kw">as.numeric</span>(id)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(id) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">column_to_rownames</span>(<span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-18" data-line-number="18"><span class="kw">filter</span>(zscore<span class="op">&gt;</span><span class="dv">0</span>, adjp<span class="op">&lt;</span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-19" data-line-number="19"><span class="kw">mutate</span>(<span class="dt">Ancestor=</span>name, <span class="dt">Genes=</span><span class="kw">str_wrap</span>(members_Overlap,<span class="dt">width=</span><span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-20" data-line-number="20"><span class="kw">select</span>(Ancestor,Genes) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tableGrob</span>(<span class="dt">rows=</span><span class="ot">NULL</span>,<span class="dt">theme=</span><span class="kw">ttheme_default</span>(<span class="dt">base_size=</span><span class="dv">6</span>)) -&gt;<span class="st"> </span>gt_psg</a>
<a class="sourceLine" id="cb34-21" data-line-number="21"></a>
<a class="sourceLine" id="cb34-22" data-line-number="22"><span class="co"># visualise together the forest plot and the table together</span></a>
<a class="sourceLine" id="cb34-23" data-line-number="23"><span class="co"># using the package &quot;patchwork&quot;, a composer of plots </span></a>
<a class="sourceLine" id="cb34-24" data-line-number="24">gg_psg <span class="op">+</span><span class="st"> </span>gt_psg <span class="op">+</span><span class="st"> </span><span class="kw">plot_layout</span>(<span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">widths=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:3-evolution"></span>
<img src="GINI_files/figure-html/3-evolution-1.png" alt="Evolutionary analysis for genes involved in abundant interactions in cluster 5. Left, the forest plot showing phylostrata (ancestors; ordered by evolutionary history) enriched and depleted based on two-sided Fisher's exact test. Right, a table listing genes first created at the ancestors (enriched)." width="100%" />
<p class="caption">
FIGURE 5.8: Evolutionary analysis for genes involved in abundant interactions in cluster 5. Left, the forest plot showing phylostrata (ancestors; ordered by evolutionary history) enriched and depleted based on two-sided Fisher’s exact test. Right, a table listing genes first created at the ancestors (enriched).
</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="session-info.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "github", "twitter", "linkedin", "weibo", "instapaper", "vk"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": false,
"info": false
});
});
</script>

</body>

</html>
